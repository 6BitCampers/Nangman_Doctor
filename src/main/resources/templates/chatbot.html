<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<div layout:fragment="content">
    <style>
        /* 모달 창이 화면 오른쪽에 고정되도록 스타일 수정 */
        .modal-chat {
            display: none;
            position: fixed;
            z-index: 1;
            right: 0;
            top: 0;
            width: 400px; /* 원하는 너비로 조정 */
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
            float: right;
            transition: transform 0.5s ease-out;
        }
        .modal-chat.slide-out {
            transform: translateX(100%);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
        }

        .close_btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            background: none;
            border: none;
        }

        .close_btn:hover,
        .close_btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .btn_info_wrap button {
            margin: 5px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn_info_wrap button:hover {
            background-color: #0056b3;
        }

        .chat_input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: calc(100% - 60px);
        }

        .send_btn {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 40px;
        }

        .send_btn:hover {
            background-color: #0056b3;
        }

        .msg_box {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            word-wrap: break-word;
        }

        .send {
            background-color: #d1e7dd;
            text-align: right;
        }

        .receive {
            background-color: #f8d7da;
            text-align: left;
        }

        .relative {
            position: relative;
            width: 100%;
            height: 100vh;
        }

        .absolute {
            position: absolute;
        }

        .bottom-4 {
            bottom: 1rem;
        }

        .right-4 {
            right: 1rem;
        }

        .inline-flex {
            display: inline-flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .whitespace-nowrap {
            white-space: nowrap;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .font-medium {
            font-weight: 500;
        }

        .ring-offset-background {
            ring-offset-color: #fff;
        }

        .transition-colors {
            transition: color 0.2s;
        }

        .focus-visible\:outline-none:focus-visible {
            outline: none;
        }

        .focus-visible\:ring-2:focus-visible {
            box-shadow: 0 0 0 2px #fff;
        }

        .focus-visible\:ring-ring:focus-visible {
            ring-color: #fff;
        }

        .focus-visible\:ring-offset-2:focus-visible {
            ring-offset-width: 2px;
        }

        .disabled\:pointer-events-none:disabled {
            pointer-events: none;
        }

        .disabled\:opacity-50:disabled {
            opacity: 0.5;
        }

        .hover\:text-accent-foreground:hover {
            color: #ff0;
        }

        .h-10 {
            height: 2.5rem;
        }

        .w-10 {
            width: 2.5rem;
        }

        .bg-primary {
            background-color: #007bff;
        }

        .text-primary-foreground {
            color: #fff;
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .p-3 {
            padding: 0.75rem;
        }

        .shadow-lg {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .hover\:bg-primary\/90:hover {
            background-color: rgba(0, 123, 255, 0.9);
        }
    </style>

    <div class="relative w-full h-screen">
        <div class="absolute bottom-4 right-4">
            <button id="chatbotButton" class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:text-accent-foreground h-10 w-10 bg-primary text-primary-foreground rounded-full p-3 shadow-lg hover:bg-primary/90">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                    <path d="M12 8V4H8"></path>
                    <rect width="16" height="12" x="4" y="8" rx="2"></rect>
                    <path d="M2 14h2"></path>
                    <path d="M20 14h2"></path>
                    <path d="M15 13v2"></path>
                    <path d="M9 13v2"></path>
                </svg>
                <span class="sr-only">Open ChatBot</span>
            </button>
        </div>
    </div>

    <div id="chatbotModal" class="modal-chat" >
        <div class="modal-content">
            <div class="modal_header">
                <span>챗봇</span>
                <button type="button" id="close_chat_btn" class="close_btn">X</button>
            </div>
            <div id="divbox" class="chat_content">
                <div class="chat_inner" style="max-height: 1265px;">
                    반갑습니다 ! ^^<br>
                    낭만닥터 도우미 6B(육비)입니다. <br>
                    6(명의) B(itcampers)라는 뜻을 가지고 있어요 ! <br>
                    궁금한 점을 아래의 단축버튼으로 누르거나 <br>
                    직접 질문해주세요.
                    <div class="btn_info_wrap">
                        <button type="button" class="btn-link welcome1" onclick="onButtonClick('{&quot;type&quot;:&quot;TEXT&quot;,&quot;displayText&quot;:&quot;진료예약 및 변경&quot;,&quot;postback&quot;:&quot;진료예약 및 변경&quot;,&quot;link&quot;:null,&quot;phoneNumber&quot;:null,&quot;suggestion&quot;:{&quot;suggestionType&quot;:&quot;INTENT&quot;,&quot;source&quot;:&quot;진료예약 및 변경&quot;,&quot;target&quot;:&quot;352&quot;},&quot;addclass&quot;:&quot;welcome1&quot;}', 'pUP0NF8lNWDEFS7hFydz')">
                            <span>예약하기</span>
                        </button>
                        <button type="button" class="btn-link welcome5" onclick="onButtonClick('{&quot;type&quot;:&quot;TEXT&quot;,&quot;displayText&quot;:&quot;병원안내&quot;,&quot;postback&quot;:&quot;병원안내&quot;,&quot;link&quot;:null,&quot;phoneNumber&quot;:null,&quot;suggestion&quot;:{&quot;suggestionType&quot;:&quot;INTENT&quot;,&quot;source&quot;:&quot;병원안내&quot;,&quot;target&quot;:&quot;71&quot;},&quot;addclass&quot;:&quot;welcome5&quot;}', 'pUP0NF8lNWDEFS7hFydz')">
                            <span>병원검색</span>
                        </button>
                        <button type="button" class="btn-link home" onclick="location.reload()">
                            <span>처음으로</span>
                        </button>
                    </div>
                </div>
            </div>
            <form id="chatForm" style="display: inline">
                <input type="text" name="inputText" class="chat_input" id="input1" />
                <input type="button" value="전송" id="btn_submit" class="send_btn" />
            </form>
        </div>
    </div>
<img src="/icon/chatbotimg.png" onclick="toggleSlide()" alt="Chatbot Image" id="chatbotimg" style="width:50px;height:50px;position:fixed;bottom:10px;right:10px;cursor:pointer;">

<script>
    function toggleSlide() {
        const content = document.getElementById('chatbotContent');
        if (content.style.display === 'none' || content.style.display === '') {
            content.style.display = 'block';
        } else {
            content.style.display = 'none';
        }

    }
    // 챗봇 이미지 클릭 시 모달 표시
    document.getElementById('chatbotimg').onclick = function () {
        document.getElementById('chatbotModal').style.display = 'block';


        $('#btn_submit').click(function () {
            send();
        });
        $('#chatForm').on('submit', function (e) {
            e.preventDefault();
            send();
        });
        $('#close_chat_btn').on('click', function () {
            $('#chat_wrap').hide().empty();
        });

        function send() {
            $('#divbox').append('<div class="msg_box send"><span>' + $('#input1').val() + '<span></div>');
            $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
            $.ajax({
                url: '/chatbot/chatbotSend', //챗봇 api url
                type: 'post',
                dataType: 'text',
                data: {inputText: $('#input1').val()},
                success: function (data) {
                    console.log("success");
                    $('#divbox').append('<div class="msg_box receive"><span>' + data + '<span></div>');
                    $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
                }
            });
            $('#input1').val('');
        }

        $(document).ready(function () {
            // 폼 제출 이벤트 처리
            $('#chatForm').on('submit', function (event) {
                event.preventDefault();
                if ($('#inputText').val() === "") {
                    alert("질문을 입력하세요");
                    return false;
                }
                callAjax();
                $('#inputText').val(''); // 입력란 비우기
            });
        });
    }
        // 챗봇 버튼을 클릭했을 때 모달 열기
        document.getElementById('chatbotButton').onclick = function() {
        document.getElementById('chatbotModal').style.display = 'block';
    }

        // 닫기 버튼을 클릭했을 때 모달 닫기
        document.getElementById('close_chat_btn').onclick = function() {
            var modal = document.getElementById('chatbotModal');
            modal.classList.add('slide-out');
            // 애니메이션이 끝난 후 모달을 숨김
            setTimeout(function() {
                modal.style.display = 'none';
                modal.classList.remove('slide-out');
            }, 500); // 애니메이션 시간과 동일하게 설정


    }

        // 모달 외부를 클릭했을 때 모달 닫기
        window.onclick = function(event) {
        if (event.target == document.getElementById('chatbotModal')) {
            var modal = document.getElementById('chatbotModal');
            modal.classList.add('slide-out');

            // 애니메이션이 끝난 후 모달을 숨김
            setTimeout(function() {
                modal.style.display = 'none';
                modal.classList.remove('slide-out');
            }, 500); // 애니메이션 시간과 동일하게 설정
    }
    }


</script>
</div>
</html>
