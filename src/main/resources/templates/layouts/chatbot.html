<!doctype html>

<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<link rel="stylesheet" href="/css/chatbot.css">
<div th:fragment="chatbotFragment">

    <div id="chatbotModal" class="modal-chat" style="z-index: 100;">
        <div class="modal-content bg-orange-100">
            <div class="modal_header">
                <span>ì±—ë´‡</span>
                <button type="button" id="close_chat_btn" class="close_btn">X</button>
            </div>
            <div id="divbox" class="chat_content">
                <img src="/icon/chatIcon.png" style="width:40px; height:40px;float: left;">
                <div class="chat_inner" style="max-width:270px;max-height: 500px; " >
                    <pre style="height: 100%;">ë°˜ê°‘ìŠµë‹ˆë‹¤ ğŸ˜€ğŸ˜€
ë‚­ë§Œë‹¥í„° ë„ìš°ë¯¸ 6B(ìœ¡ë¹„)ì…ë‹ˆë‹¤.
6(ëª…ì˜) B(itcampers)ë¼ëŠ” ëœ»ì„
ê°€ì§€ê³  ìˆì–´ìš”!
ê¶ê¸ˆí•œ ì ì„ ì•„ë˜ì˜ ë‹¨ì¶•ë²„íŠ¼ìœ¼ë¡œ
ëˆ„ë¥´ê±°ë‚˜ ì§ì ‘ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.
                    </pre>
                    <div class="btn_info_wrap">
                        <th:block sec:authorize="hasAuthority('ROLE_USER')">
                        <button style="text-decoration:  none;" type="button" onclick="location.href='/results?keyword=ì„±í˜•'" class="btn-link welcome1" >
                            <span >ì˜ˆì•½í•˜ê¸°</span>
                        </button>
                        </th:block>
                        <th:block sec:authorize="isAnonymous()">
                        <button style="text-decoration:  none;" type="button" onclick="noresurv()" class="btn-link welcome1" >
                            <span>ì˜ˆì•½í•˜ê¸°</span>
                        </button>
                        </th:block>
                        <button style="text-decoration:  none;" type="button" class="btn-link welcome5" onclick="searchbtn()">
                            <span>ë³‘ì›ê²€ìƒ‰</span>
                        </button>
                        <button style="text-decoration:  none;" type="button" class="btn-link welcome5" onclick="location.href='/'">
                            <span>ë©”ì¸ìœ¼ë¡œ</span>
                        </button>
                        <button style="text-decoration:  none;" type="button" class="btn-link welcome5" onclick="reviewbtn()">
                            <span>ë¦¬ë·°ë³´ê¸°</span>
                        </button>
                    </div>
                </div>
            </div>
            <form id="chatForm"class="chatForm" style="display: inline">
                <input type="text" name="inputText" class="chat_input" id="input1" />
                <input type="button" value="ì „ì†¡" id="btn_submit" class="send_btn" />
            </form>
        </div>
    </div>
    <img src="/icon/chatbotimg.png" onclick="toggleSlide()" alt="Chatbot Image" id="chatbotimg" style="z-index: 100; width:60px;height:60px;position:fixed;bottom:20px;right:30px;cursor:pointer;">
    <script>
        function toggleSlide() {
            const content = document.getElementById('chatbotModal');
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }
        function noresurv(){
            $('#divbox').append('<div class="msg_box receive"><span>ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ğŸ˜‚<span></div>');
            $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
        }
        function searchbtn(){
            $('#divbox').append('<div class="msg_box receive"><span>ë³‘ì›ì„ ê²€ìƒ‰í•˜ì‹¤ ìˆ˜ ìˆê²Œ ë„ì™€ë“œë¦´ê²Œìš” ğŸ˜‡<span></div>');
            $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
            location.href='/search';
        }
        function reviewbtn(){
            $('#divbox').append('<div class="msg_box receive"><span>ë‹¤ì–‘í•œ í›„ê¸°ë¡œ ì„ íƒì— ë„ì›€ì„ ë“œë¦´ê²Œìš” ğŸ˜‹<span></div>');
            $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
            location.href='/reviewboard';
        }
        // ì±—ë´‡ ì´ë¯¸ì§€ í´ë¦­ ì‹œ ëª¨ë‹¬ í‘œì‹œ
        document.getElementById('chatbotimg').onclick = function () {
            document.getElementById('chatbotModal').style.display = 'block';

            $('#btn_submit').click(function () {
                send();
            });
            $('#chatForm').on('submit', function (e) {
                e.preventDefault();
                send();
            });
            $('#close_chat_btn').on('click', function () {
                $('#chat_wrap').hide().empty();
            });

            function send() {
                $('#divbox').append('<div class="msg_box send"><span>' + $('#input1').val() + '<span></div>');
                $("#divbox").scrollTop($("#divbox")[0].scrollHeight);

                $.ajax({
                    url: '/chatbot/chatbotSend', //ì±—ë´‡ api url
                    type: 'post',
                    dataType: 'text',
                    data: {inputText: $('#input1').val()},
                    success: function (data) {
                        console.log("success");
                        $('#divbox').append('<img src="/icon/chatIcon.png" style="width:40px; height:40px;margin-top:50px;float: left;">');
                        $('#divbox').append('<div class="msg_box receive"><span>' + data + '<span></div>');
                        $("#divbox").scrollTop($("#divbox")[0].scrollHeight);

                    }
                });
                $('#input1').val('');
            }

        }

        // ë‹«ê¸° ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ ëª¨ë‹¬ ë‹«ê¸°
        document.getElementById('close_chat_btn').onclick = function() {
            var modal = document.getElementById('chatbotModal');
            modal.classList.add('slide-out');
            // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚œ í›„ ëª¨ë‹¬ì„ ìˆ¨ê¹€
            setTimeout(function() {
                modal.style.display = 'none';
                modal.classList.remove('slide-out');
            }, 500); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •

        }

        // ëª¨ë‹¬ ì™¸ë¶€ë¥¼ í´ë¦­í–ˆì„ ë•Œ ëª¨ë‹¬ ë‹«ê¸°
        window.onclick = function(event) {
            if (event.target == document.getElementById('chatbotModal')) {
                var modal = document.getElementById('chatbotModal');
                modal.classList.add('slide-out');

                // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚œ í›„ ëª¨ë‹¬ì„ ìˆ¨ê¹€
                setTimeout(function() {
                    modal.style.display = 'none';
                    modal.classList.remove('slide-out');
                }, 500); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •
            }
        }
    </script>
</div>
</div>
</html>