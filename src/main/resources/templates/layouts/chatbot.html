<!doctype html>

<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<link rel="stylesheet" href="/css/chatbot.css">
<div th:fragment="chatbotFragment">

    <div id="chatbotModal" class="modal-chat" style="z-index: 100;">
        <div class="modal-content bg-orange-100">
            <div class="modal_header">
                <span>챗봇</span>
                <button type="button" id="close_chat_btn" class="close_btn">X</button>
            </div>
            <div id="divbox" class="chat_content">
                <div class="chat_inner" style="max-height: 1265px;">
                    <pre>반갑습니다 ! ^-^
낭만닥터 도우미 6B(육비)입니다.
6(명의) B(itcampers)라는 뜻을
가지고 있어요!
궁금한 점을 아래의 단축버튼으로 누르거나
직접 질문해주세요.
                    </pre>
                    <div class="btn_info_wrap">
                        <button type="button" th:onclick="" class="btn-link welcome1" onclick="onButtonClick('{&quot;type&quot;:&quot;TEXT&quot;,&quot;displayText&quot;:&quot;진료예약 및 변경&quot;,&quot;postback&quot;:&quot;진료예약 및 변경&quot;,&quot;link&quot;:null,&quot;phoneNumber&quot;:null,&quot;suggestion&quot;:{&quot;suggestionType&quot;:&quot;INTENT&quot;,&quot;source&quot;:&quot;진료예약 및 변경&quot;,&quot;target&quot;:&quot;352&quot;},&quot;addclass&quot;:&quot;welcome1&quot;}', 'pUP0NF8lNWDEFS7hFydz')">
                            <span>예약하기</span>
                        </button>
                        <button type="button" class="btn-link welcome5" onclick="onButtonClick('{&quot;type&quot;:&quot;TEXT&quot;,&quot;displayText&quot;:&quot;병원안내&quot;,&quot;postback&quot;:&quot;병원안내&quot;,&quot;link&quot;:null,&quot;phoneNumber&quot;:null,&quot;suggestion&quot;:{&quot;suggestionType&quot;:&quot;INTENT&quot;,&quot;source&quot;:&quot;병원안내&quot;,&quot;target&quot;:&quot;71&quot;},&quot;addclass&quot;:&quot;welcome5&quot;}', 'pUP0NF8lNWDEFS7hFydz')">
                            <span>병원검색</span>
                        </button>
                        <button type="button" class="btn-link home" onclick="location.reload()">
                            <span>처음으로</span>
                        </button>
                    </div>
                </div>
            </div>
            <form id="chatForm"class="chatForm" style="display: inline">
                <input type="text" name="inputText" class="chat_input" id="input1" />
                <input type="button" value="전송" id="btn_submit" class="send_btn" />
            </form>
        </div>
    </div>
    <img src="/icon/chatbotimg.png" onclick="toggleSlide()" alt="Chatbot Image" id="chatbotimg" style="z-index: 100; width:50px;height:50px;position:fixed;bottom:10px;right:10px;cursor:pointer;">

    <script>
        function toggleSlide() {
            const content = document.getElementById('chatbotModal');
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }

        }
        // 챗봇 이미지 클릭 시 모달 표시
        document.getElementById('chatbotimg').onclick = function () {
            document.getElementById('chatbotModal').style.display = 'block';


            $('#btn_submit').click(function () {
                send();
            });
            $('#chatForm').on('submit', function (e) {
                e.preventDefault();
                send();
            });
            $('#close_chat_btn').on('click', function () {
                $('#chat_wrap').hide().empty();
            });

            function send() {
                $('#divbox').append('<div class="msg_box send"><span>' + $('#input1').val() + '<span></div>');
                $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
                $.ajax({
                    url: '/chatbot/chatbotSend', //챗봇 api url
                    type: 'post',
                    dataType: 'text',
                    data: {inputText: $('#input1').val()},
                    success: function (data) {
                        console.log("success");
                        $('#divbox').append('<div class="msg_box receive"><span>' + data + '<span></div>');
                        $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
                    }
                });
                $('#input1').val('');
            }

            $(document).ready(function () {
                // 폼 제출 이벤트 처리
                $('#chatForm').on('submit', function (event) {
                    event.preventDefault();
                    if ($('#inputText').val() === "") {
                        alert("질문을 입력하세요");
                        return false;
                    }
                    callAjax();
                    $('#inputText').val(''); // 입력란 비우기
                });
            });
        }

        // 닫기 버튼을 클릭했을 때 모달 닫기
        document.getElementById('close_chat_btn').onclick = function() {
            var modal = document.getElementById('chatbotModal');
            modal.classList.add('slide-out');
            // 애니메이션이 끝난 후 모달을 숨김
            setTimeout(function() {
                modal.style.display = 'none';
                modal.classList.remove('slide-out');
            }, 500); // 애니메이션 시간과 동일하게 설정


        }

        // 모달 외부를 클릭했을 때 모달 닫기
        window.onclick = function(event) {
            if (event.target == document.getElementById('chatbotModal')) {
                var modal = document.getElementById('chatbotModal');
                modal.classList.add('slide-out');

                // 애니메이션이 끝난 후 모달을 숨김
                setTimeout(function() {
                    modal.style.display = 'none';
                    modal.classList.remove('slide-out');
                }, 500); // 애니메이션 시간과 동일하게 설정
            }
        }


    </script>
</div>
</div>
</html>